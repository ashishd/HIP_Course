#/bin/bash

module load cmake/3.24.3 craype-accel-amd-gfx90a rocm/5.2.3 omnitrace/1.10.2 omniperf/1.0.6 

# Get the directory that this file is located in
COURSE_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )

# Set the installation directory
INSTALL_DIR=$COURSE_DIR/install

# Set the runtime directory
RUN_DIR=$INSTALL_DIR/bin

# Change the path
export PATH=$PATH:$RUN_DIR

# Set the platform, amd or nvidia
export HIP_PLATFORM=amd

# Must set vendor-specific and semicolon-separated list of GPU architectures to support,
# i.e 75;86;90 or gfx90a;gfx906;gfx1035 
#export GPU_ARCH="60;61;70;75;80;86;89;90"
export GPU_ARCH="gfx90a"

# Set the build type, options are DEBUG, COVERAGE, PROFILE, RELEASE
export BUILD_TYPE=RELEASE

# Force HIP compiler to accept -fPIC
export HIPFLAGS="-fPIC"

# Extra flags to enable GPU support
MPICH_GPU_SUPPORT_ENABLED=1